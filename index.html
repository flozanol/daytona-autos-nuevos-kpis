// Crear encabezados
const headers = ['KPI', ...singleSelectedMonths, 'Promedio', 'Tendencia'];
singleTableHeader.innerHTML = headers.map(header => `<th>${header}</th>`).join('');

// Crear filas con promedio y tendencia
singleTableBody.innerHTML = agency.kpis.map(kpi => {
    const rowValues = singleSelectedMonths.map(month => kpi[month] || 0);
    const average = rowValues.reduce((sum, val) => sum + val, 0) / rowValues.length;
    const formattedAvg = formatNumber(average);

    // Tendencia: comparar primer y último mes
    const first = rowValues[0], last = rowValues[rowValues.length - 1];
    let trendSymbol = '→';
    let trendClass = '';
    if (first !== 0) {
        const change = ((last - first) / first) * 100;
        if (change > 5) {
            trendSymbol = '▲'; trendClass = 'text-green-400';
        } else if (change < -5) {
            trendSymbol = '▼'; trendClass = 'text-red-400';
        }
    }

    const cells = [kpi.name, ...rowValues.map(v => `<td>${formatNumber(v)}</td>`)];
    cells.push(`<td>${formattedAvg}</td>`);
    cells.push(`<td class="${trendClass} font-bold">${trendSymbol}</td>`);

    return `<tr>${cells.map(c => typeof c === 'string' ? c : `<td>${formatNumber(c)}</td>`).join('')}</tr>`;
}).join('');
